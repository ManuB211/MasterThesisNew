import pm4py
import sys
import os
from graphviz import Source


def display_model(directory, folder):
    
    for model in os.listdir(directory):
        print(model)
        
        file_path_in = directory+"/"+model
        file_path_out = directory+"/"+model.split(".")[0]+"_Visualization"
    
        if not os.path.exists(file_path_in):
            raise FileNotFoundError(f"The file {file_path_in} does not exist.")

        try:
            # Import the model from the DOT file
            with open(file_path_in, "r") as file:
                model_content = file.read()

            # Create Graph object
            model_graph = Source(model_content)

            # Save the model as image
            model_graph.render(file_path_out, format="png", cleanup=True)

            print(f"Visualization saved to {file_path_out}. You can view it using an image viewer.")

        except Exception as e:
            raise Error(f"An error occurred: {e}")

    
# Main
if __name__ == "__main__":
    timestamp = sys.argv[1]
    folder = sys.argv[2]
    #Punkte weg!
    directory = "target/{}/{}".format(timestamp, folder)
    display_model(directory, folder)
